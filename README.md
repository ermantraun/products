```markdown
# 3. –°–µ—Ä–≤–∏—Å ¬´–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∑–∞–∫–∞–∑¬ª

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- FastAPI ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è REST API
- SQLAlchemy ‚Äî ORM
- Pydantic ‚Äî DTO/–≤–∞–ª–∏–¥–∞—Ü–∏—è
- Dishka-like IoC (–ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —á–µ—Ä–µ–∑ FastAPI Depends)
- PostgreSQL ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–æ–¥–∞–∫—à–Ω/—á–µ—Ä–µ–∑ docker-compose
- Pytest ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Docker / docker-compose ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
project/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ v1/
‚îÇ           ‚îú‚îÄ‚îÄ handlers/
‚îÇ           ‚îú‚îÄ‚îÄ application/
‚îÇ           ‚îú‚îÄ‚îÄ domen/
‚îÇ           ‚îú‚îÄ‚îÄ infrastructure/
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ db/
‚îÇ           ‚îú‚îÄ‚îÄ ioc.py
‚îÇ           ‚îú‚îÄ‚îÄ main.py
‚îÇ           ‚îî‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

---

## ‚öô –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–∏—Ç–∞–µ—Ç DATABASE_URL –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è docker-compose:

DATABASE_URL=postgresql+psycopg2://postgres:postgres@db:5432/app_db

–ï—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ Postgres, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite:
DATABASE_URL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: sqlite:///./test.db

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ requirements.txt –∏–º–µ—Ç—å psycopg2-binary –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Postgres –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
- psycopg2-binary

---

## üê≥ Docker –∏ docker-compose

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å docker-compose.yml –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è:

- –°–µ—Ä–≤–∏—Å db: Postgres (named volume –¥–ª—è –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è)
- –°–µ—Ä–≤–∏—Å web: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ FastAPI (uvicorn)
- –°–µ—Ä–≤–∏—Å pgadmin: –≤–∏–∑—É–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ö–æ–º–∞–Ω–¥—ã:

1) –°–æ–±—Ä–∞—Ç—å –∏ –ø–æ–¥–Ω—è—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:
   docker compose up --build -d

2) –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   docker compose logs -f web

3) –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —Ç–æ–º–∞ –¥–∞–Ω–Ω—ã—Ö:
   docker compose down -v

–í–∞–∂–Ω–æ:
- –í docker-compose –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è web –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è DATABASE_URL, –Ω–∞–ø—Ä–∏–º–µ—Ä:
  postgresql+psycopg2://postgres:postgres@db:5432/app_db
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ requirements.txt –µ—Å—Ç—å psycopg2-binary –∏–ª–∏ –≤ Dockerfile —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ psycopg2.
- –í Dockerfile –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞ uvicorn; web –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∂–¥—ë—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î —á–µ—Ä–µ–∑ depends_on + healthcheck.

---

## üöÄ –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ docker)

1) –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt

2) –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é SQLite –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–æ DATABASE_URL):
   uvicorn backend.api.v1.main:app --reload

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ:
   pytest -q

–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ web –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ):
   docker compose exec web pytest -q

---

## üì¶ API

POST /orders/{order_id}/items
- body: {"product_id": int, "quantity": int}
- –û—Ç–≤–µ—Ç—ã:
  - 200 ‚Äî —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω/–æ–±–Ω–æ–≤–ª—ë–Ω (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫–∞–∑–∞)
  - 404 ‚Äî –∑–∞–∫–∞–∑ –∏–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
  - 400 ‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ

–ü—Ä–∏–º–µ—Ä curl:
curl -X POST "http://127.0.0.1:8000/orders/1/items" -H "Content-Type: application/json" -d '{"product_id":1,"quantity":2}'

---

## üß≠ –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- CI / Production:
  - –†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π –ë–î.
  - –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ Docker image –∏ –Ω–µ –º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–æ–¥ —á–µ—Ä–µ–∑ volumes.
- Dockerfile:
  - –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ psycopg2-binary ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ requirements.txt.
  - –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ psycopg2 (–Ω–µ-binary) ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (libpq-dev, build-essential).
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î:
  - –í —Ç–µ–∫—É—â–µ–º –ø—Ä–∏–º–µ—Ä–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ db_models.Base.metadata.create_all(bind=engine) –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (ioc.init_db).

---

–°–ø–∞—Å–∏–±–æ ‚Äî —è –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–ª README –ø–æ–¥ docker-compose, –¥–æ–±–∞–≤–∏–ª –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É, –æ–∫—Ä—É–∂–µ–Ω–∏—é –∏ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É —Å—Ä–∞–∑—É:
- –ø–æ–∫–∞–∑–∞—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π Dockerfile –∏ requirements.txt —Å psycopg2-binary,
- –ª–∏–±–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π entrypoint-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ë–î –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º uvicorn.
```